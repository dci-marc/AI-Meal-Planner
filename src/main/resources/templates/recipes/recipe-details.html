<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${recipe.title}">Recipe Details</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f7f7fb; }
        .hero {
            background: linear-gradient(180deg, #ffffff, #f7f7fb);
            border-bottom: 1px solid rgba(0,0,0,.06);
        }
        .recipe-title {
            font-weight: 700;
            letter-spacing: .2px;
        }
        .meta-badge { font-weight: 600; }
        .meta-item { display: inline-flex; align-items: center; gap: .5rem; }
        .recipe-cover {
            width: 100%;
            height: 320px;
            object-fit: cover;
            border-radius: .75rem;
        }
        @media (min-width: 992px) {
            .recipe-cover { height: 420px; }
        }
        .pill-stat {
            border: 1px solid rgba(0,0,0,.08);
            border-radius: .75rem;
            background: #fff;
        }
        .pill-stat .value { font-weight: 700; font-size: clamp(1.25rem, 2.2vw, 1.75rem); }
        .pill-stat .label { color: #6c757d; font-size: .9rem; }
        .section-card {
            background: #fff;
            border: 1px solid rgba(0,0,0,.06);
            border-radius: .75rem;
        }
        .section-card .card-header {
            background: transparent;
            border-bottom: 1px solid rgba(0,0,0,.06);
            font-weight: 700;
        }
        .category-badge { background: #eef5ff; color: #0d6efd; }
        .ingredients-list .list-group-item { border: none; border-bottom: 1px dashed rgba(0,0,0,.08); }
        .ingredients-list .list-group-item:last-child { border-bottom: none; }
        .instructions-text { white-space: pre-line; line-height: 1.7; }
        .btn-toolbar .btn { min-width: 140px; }
    </style>
</head>
<body>

<header class="hero py-4">
    <div class="container">
        <div class="d-flex flex-column flex-lg-row align-items-lg-end justify-content-between gap-3">
            <div>
                <h1 class="recipe-title mb-2" th:text="${recipe.title}">Recipe Title</h1>
                <div class="d-flex flex-wrap gap-3">
                    <span class="meta-item">
                        <span class="badge text-bg-light meta-badge">Author</span>
                        <span th:text="${author.email}">author@email.com</span>
                    </span>
                    <span class="meta-item">
                        <span class="badge text-bg-light meta-badge">Difficulty</span>
                        <span th:text="${#strings.toLowerCase(recipe.difficulty)}">easy</span>
                    </span>
                    <span class="meta-item">
                        <span class="badge text-bg-light meta-badge">Prep</span>
                        <span th:text="${recipe.preparationTimeMinutes + ' min'}">30 min</span>
                    </span>
                    <span class="meta-item" th:if="${recipe != null and recipe.servings != null}">
                        <span class="badge text-bg-light meta-badge">Servings</span>
                        <span th:text="${recipe.servings}">2</span>
                    </span>
                </div>
                <div class="mt-3 d-flex flex-wrap gap-2">
                    <span class="badge category-badge" th:each="cat : ${recipe.mealCategories}" th:text="${cat.name}">Category</span>
                </div>
            </div>
            <div class="btn-toolbar gap-2">
                <a th:href="${redirectUrl}" class="btn btn-outline-secondary">Back to List</a>
                <a th:if="${currentUserId == author.id}" th:href="@{/recipes/edit/{id}(id=${recipe.id})}" class="btn btn-primary">Edit</a>
                <a th:if="${currentUserId == author.id}" th:href="@{/recipes/delete/{id}(id=${recipe.id})}" class="btn btn-danger">Delete</a>
                <a th:href="@{/recipes/generate/{id}(id=${recipe.id})}" class="btn btn-outline-success">Download PDF</a>
            </div>
        </div>
    </div>
</header>

<main class="container py-4">
    <div class="row g-4">
        <div class="col-12">
            <div th:if="${recipe.image != null}">
                <img th:src="${recipe.image.imageUrl}" class="recipe-cover" alt="Recipe Image">
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card section-card mb-4">
                <div class="card-header">Ingredients</div>
                <div class="card-body">
                    <ul class="list-group ingredients-list">
                        <li class="list-group-item px-0"
                            th:each="recipeIngredient : ${recipe.ingredients}"
                            th:text="${recipeIngredient.amount + ' ' + recipeIngredient.unit.displayName + ' ' + recipeIngredient.ingredient.name}">
                            Ingredient
                        </li>
                    </ul>
                </div>
            </div>

            <div class="card section-card mb-4">
                <div class="card-header">Instructions</div>
                <div class="card-body">
                    <div class="instructions-text" th:text="${recipe.instructions}">Instructions go here.</div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card section-card">
                <div class="card-header">Nutrition Facts</div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        Calculated from ingredient amounts
                        <span th:if="${recipe != null and recipe.servings != null}"> • Servings: <strong th:text="${recipe.servings}"></strong></span>
                    </p>
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="p-3 pill-stat text-center">
                                <div class="value">
                                    <span th:text="${recipe.kcalPerServ ?: '—'}"></span>
                                    <span th:if="${recipe.kcalPerServ != null}">kcal</span>
                                </div>
                                <div class="label">Energy</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 pill-stat text-center">
                                <div class="value">
                                    <span th:text="${recipe.proteinPerServ ?: '—'}"></span>
                                    <span th:if="${recipe.proteinPerServ != null}">g</span>
                                </div>
                                <div class="label">Protein</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 pill-stat text-center">
                                <div class="value">
                                    <span th:text="${recipe.carbsPerServ ?: '—'}"></span>
                                    <span th:if="${recipe.carbsPerServ != null}">g</span>
                                </div>
                                <div class="label">Carbs</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 pill-stat text-center">
                                <div class="value">
                                    <span th:text="${recipe.fatPerServ ?: '—'}"></span>
                                    <span th:if="${recipe.fatPerServ != null}">g</span>
                                </div>
                                <div class="label">Fat</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(recipe.ingredients)}" class="alert alert-warning mt-4 mb-0">
                Ingredients are missing for this recipe.
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
