<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AI Generated Recipe</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
</head>
<body class="container py-4">

<h2>AI Generated Recipe</h2>

<div th:if="${error}">
    <div class="alert alert-danger" th:text="${error}"></div>
</div>

<div th:if="${aiRecipe != null}">
    <div class="card mb-3">
        <div class="card-body">
            <h3 th:text="${aiRecipe.title}"></h3>
            <p>
                <strong>Difficulty:</strong> <span th:text="${aiRecipe.difficulty}"></span><br>
                <strong>Preparation Time:</strong>
                <span th:text="${aiRecipe.preparationTimeMinutes}"></span> minutes<br>
                <strong>Servings:</strong> <span th:text="${aiRecipe.servings}"></span><br>
                <strong>Categories:</strong>
                <span th:each="cat,iter : ${aiRecipe.mealCategories}">
                    <span th:text="${!iter.first ? ', ' : ''} + ${cat}"></span>
                </span>
            </p>
        </div>
    </div>

    <h4>Ingredients</h4>
    <ul class="list-group mb-3">
        <li class="list-group-item"
            th:each="ing : ${aiRecipe.ingredients}">
            <span th:text="${ing.amount}"></span>
            <span th:text="${ing.unitCode}"></span>
            <span th:text="${ing.name}"></span>
            <span class="text-muted" th:if="${ing.note != null}"
                  th:text="'(' + ${ing.note} + ')'"></span>
        </li>
    </ul>

    <h4>Instructions</h4>
    <ol class="list-group list-group-numbered mb-3">
        <li class="list-group-item"
            th:each="step : ${aiRecipe.instructions}"
            th:text="${step}"></li>
    </ol>

    <form th:action="@{/recipes/save-ai}" method="post" th:object="${aiRecipe}">
        <input type="hidden" th:field="*{title}"/>
        <input type="hidden" th:field="*{difficulty}"/>
        <input type="hidden" th:field="*{preparationTimeMinutes}"/>
        <input type="hidden" th:field="*{servings}"/>

        <th:block th:if="*{mealCategories} != null"
                  th:each="cat, iStat : *{mealCategories}">
            <input type="hidden"
                   th:field="*{mealCategories[__${iStat.index}__]}"
                   th:value="${cat}"/>
        </th:block>

        <th:block th:if="*{ingredients} != null"
                  th:each="ing, iStat : *{ingredients}">
            <input type="hidden"
                   th:name="${'ingredients[' + iStat.index + '].name'}"
                   th:value="${ing.name}"/>
            <input type="hidden"
                   th:name="${'ingredients[' + iStat.index + '].unitCode'}"
                   th:value="${ing.unitCode}"/>
            <input type="hidden"
                   th:name="${'ingredients[' + iStat.index + '].amount'}"
                   th:value="${ing.amount}"/>
            <input type="hidden"
                   th:name="${'ingredients[' + iStat.index + '].note'}"
                   th:value="${ing.note}"/>
        </th:block>

        <th:block th:if="*{instructions} != null"
                  th:each="step, iStat : *{instructions}">
            <input type="hidden"
                   th:name="${'instructions[' + iStat.index + ']'}"
                   th:value="${step}"/>
        </th:block>

        <button class="btn btn-success">Save Recipe</button>
        <a th:href="@{/recipes/ask-ai}" class="btn btn-secondary">Back</a>
    </form>
</div>

</body>
</html>
