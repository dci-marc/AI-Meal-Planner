<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AI Generated Recipe</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
</head>
<body class="container py-4">

<h2>AI Generated Recipe</h2>

<div th:if="${error}">
    <div class="alert alert-danger" th:text="${error}"></div>
</div>

<div th:if="${aiRecipe != null}">
    <div class="card mb-3">
        <div class="card-body">
            <h3 th:text="${aiRecipe.title}"></h3>
            <p>
                <strong>Difficulty:</strong> <span th:text="${aiRecipe.difficulty}"></span><br>
                <strong>Preparation Time:</strong>
                <span th:text="${aiRecipe.preparation_time_minutes}"></span> minutes<br>
                <strong>Servings:</strong> <span th:text="${aiRecipe.servings}"></span><br>
                <strong>Categories:</strong>
                <span th:each="cat,iter : ${aiRecipe.meal_categories}"
                      th:text="${cat}"
                      th:append="${!iter.last ? ', ' : ''}"></span>
            </p>
        </div>
    </div>

    <h4>Ingredients</h4>
    <ul class="list-group mb-3">
        <li class="list-group-item"
            th:each="ing : ${aiRecipe.ingredients}">
            <span th:text="${ing.amount}"></span>
            <span th:text="${ing.unit_code}"></span>
            <span th:text="${ing.name}"></span>
            <span class="text-muted" th:if="${ing.note != null}"
                  th:text="'(' + ${ing.note} + ')'"></span>
        </li>
    </ul>

    <h4>Instructions</h4>
    <ol class="list-group list-group-numbered mb-3">
        <li class="list-group-item"
            th:each="step : ${aiRecipe.instructions}"
            th:text="${step}"></li>
    </ol>

    <!-- Save form -->
    <form th:action="@{/recipes/save-ai}" method="post">
        <input type="hidden" name="title" th:value="${aiRecipe.title}"/>
        <input type="hidden" name="difficulty" th:value="${aiRecipe.difficulty}"/>
        <input type="hidden" name="preparation_time_minutes"
               th:value="${aiRecipe.preparation_time_minutes}"/>
        <input type="hidden" name="servings" th:value="${aiRecipe.servings}"/>
        <input type="hidden" name="meal_categories"
               th:value="${#strings.arrayJoin(aiRecipe.meal_categories, ',')}"/>
        <!-- You could also serialize ingredients + instructions as JSON in hidden fields -->
        <button class="btn btn-success">Save Recipe</button>
        <a th:href="@{/recipes/ask-ai}" class="btn btn-secondary">Back</a>
    </form>
</div>

</body>
</html>
