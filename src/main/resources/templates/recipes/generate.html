<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AI Generated Recipe</title>
    <link rel="stylesheet" href="/css/navigation_tab_styles.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>

    <style>
        body { background: #f7f7fb; }
        .hero {
            background: linear-gradient(180deg, #ffffff, #f7f7fb);
            border-bottom: 1px solid rgba(0,0,0,.06);
        }
        .recipe-title { font-weight: 700; letter-spacing: .2px; }
        .meta-item { display: inline-flex; align-items: center; gap: .5rem; }
        .meta-badge { font-weight: 600; }
        .category-badge { background: #eef5ff; color: #0d6efd; }
        .section-card {
            background: #fff; border: 1px solid rgba(0,0,0,.06); border-radius: .75rem;
        }
        .section-card .card-header {
            background: transparent; border-bottom: 1px solid rgba(0,0,0,.06); font-weight: 700;
        }
        .ingredients-list .list-group-item { border: none; border-bottom: 1px dashed rgba(0,0,0,.08); }
        .ingredients-list .list-group-item:last-child { border-bottom: none; }
        .instructions-text { white-space: pre-line; line-height: 1.7; }
        .btn-toolbar .btn { min-width: 140px; }
    </style>
</head>
<body class="bg-light d-flex flex-column min-vh-100">
<div th:replace="~{fragments/navigation_tab :: navigation}"></div>

<header class="hero py-4">
    <div class="container">
        <h2 class="recipe-title mb-0">AI Generated Recipe</h2>
    </div>
</header>

<main class="container py-4 flex-grow-1">
    <div th:if="${error}">
        <div class="alert alert-danger" th:text="${error}"></div>
    </div>

    <div th:if="${aiRecipe != null}">
        <div class="card section-card mb-4">
            <div class="card-body">
                <div class="d-flex flex-column flex-lg-row align-items-lg-end justify-content-between gap-3">
                    <div>
                        <h3 class="mb-2" th:text="${aiRecipe.title}">Generated Title</h3>

                        <div class="d-flex flex-wrap gap-3">
                            <span class="meta-item">
                                <span class="badge text-bg-light meta-badge">Difficulty</span>
                                <span th:text="${#strings.toLowerCase(aiRecipe.difficulty)}">easy</span>
                            </span>
                            <span class="meta-item">
                                <span class="badge text-bg-light meta-badge">Prep</span>
                                <span th:text="${aiRecipe.preparationTimeMinutes}">30</span> min
                            </span>
                            <span class="meta-item" th:if="${aiRecipe.servings != null}">
                                <span class="badge text-bg-light meta-badge">Servings</span>
                                <span th:text="${aiRecipe.servings}">2</span>
                            </span>
                        </div>

                        <div class="mt-3 d-flex flex-wrap gap-2" th:if="${aiRecipe.mealCategories != null}">
                            <span class="badge category-badge"
                                  th:each="cat : ${aiRecipe.mealCategories}"
                                  th:text="${cat}">Category</span>
                        </div>
                    </div>

                    <div class="btn-toolbar gap-2">
                        <a th:href="@{/recipes/ask-ai}" class="btn btn-outline-secondary">Back</a>
                        <form th:action="@{/recipes/save-ai}" method="post" th:object="${aiRecipe}">
                            <input type="hidden" th:field="*{title}"/>
                            <input type="hidden" th:field="*{difficulty}"/>
                            <input type="hidden" th:field="*{preparationTimeMinutes}"/>
                            <input type="hidden" th:field="*{servings}"/>

                            <th:block th:if="*{mealCategories} != null"
                                      th:each="cat, iStat : *{mealCategories}">
                                <input type="hidden"
                                       th:field="*{mealCategories[__${iStat.index}__]}"
                                       th:value="${cat}"/>
                            </th:block>

                            <th:block th:if="*{ingredients} != null"
                                      th:each="ing, iStat : *{ingredients}">
                                <input type="hidden"
                                       th:name="${'ingredients[' + iStat.index + '].name'}"
                                       th:value="${ing.name}"/>
                                <input type="hidden"
                                       th:name="${'ingredients[' + iStat.index + '].unitCode'}"
                                       th:value="${ing.unitCode}"/>
                                <input type="hidden"
                                       th:name="${'ingredients[' + iStat.index + '].amount'}"
                                       th:value="${ing.amount}"/>
                                <input type="hidden"
                                       th:name="${'ingredients[' + iStat.index + '].note'}"
                                       th:value="${ing.note}"/>
                            </th:block>

                            <th:block th:if="*{instructions} != null"
                                      th:each="step, iStat : *{instructions}">
                                <input type="hidden"
                                       th:name="${'instructions[' + iStat.index + ']'}"
                                       th:value="${step}"/>
                            </th:block>

                            <button class="btn btn-success">Save Recipe</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="card section-card mb-4">
            <div class="card-header">Ingredients</div>
            <div class="card-body">
                <ul class="list-group ingredients-list">
                    <li class="list-group-item px-0"
                        th:each="ing : ${aiRecipe.ingredients}"
                        th:with="
                            amt=${ing.amount != null ? ing.amount.stripTrailingZeros().toPlainString() : ''},
                            unitTxt=${ing.unitCode != null ? #strings.replace(#strings.toLowerCase(ing.unitCode),'_',' ') : ''},
                            noteTxt=${ing.note != null ? ' (' + ing.note + ')' : ''}"
                        th:text="${(amt != '' ? amt + ' ' : '')
                                  + (unitTxt != '' ? unitTxt + ' ' : '')
                                  + ing.name
                                  + noteTxt}">
                        1 cup example ingredient
                    </li>
                </ul>
            </div>
        </div>

        <div class="card section-card">
            <div class="card-header">Instructions</div>
            <div class="card-body">
                <ol class="list-group list-group-numbered">
                    <li class="list-group-item"
                        th:each="step : ${aiRecipe.instructions}"
                        th:text="${step}">Step text</li>
                </ol>
            </div>
        </div>
    </div>
</main>

</body>
</html>
