<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="UTF-8" />
    <title th:text="${recipe.title}">Recipe</title>
    <style>
        @page { margin: 20mm; }
        :root { --ink:#1f2937; --muted:#6b7280; --accent:#0d6efd; --soft:#eef2f7; --border:#e5e7eb; }
        * { box-sizing: border-box; }
        body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Noto Sans","Helvetica Neue",sans-serif; color:var(--ink); line-height:1.55; font-size:12pt; }
        h1,h2,h3 { margin:0 0 .5rem; line-height:1.25; }
        h1 { font-size:24pt; font-weight:800; letter-spacing:.2px; }
        h2 { font-size:16pt; font-weight:700; margin-top:1.2rem; }
        h3 { font-size:13.5pt; font-weight:700; margin-top:1rem; }
        p, li { font-size:11.5pt; }
        .wrap { width:100%; }
        .header { padding-bottom:12px; border-bottom:1px solid var(--border); margin-bottom:14px; }
        .meta { display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:8px 14px; margin-top:8px; color:var(--muted); font-size:10.5pt; }
        .meta strong { color:var(--ink); font-weight:700; }
        .badges { display:inline-flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
        .badge { font-size:10pt; font-weight:600; padding:4px 8px; border-radius:999px; background:#e9f2ff; color:var(--accent); border:1px solid #d7e6ff; }
        .hero { width:100%; margin:14px 0 18px; border:1px solid var(--border); border-radius:8px; overflow:hidden; background:#fff; }
        .hero img { width:100%; height:280px; object-fit:cover; display:block; }
        .grid { display:grid; grid-template-columns:1.2fr .8fr; gap:18px; width:100%; }
        .card { border:1px solid var(--border); border-radius:10px; background:#fff; padding:14px; }
        .card + .card { margin-top:12px; }
        .subtle { color:var(--muted); }
        .list { list-style:none; padding:0; margin:0; }
        .list li { padding:8px 0; border-bottom:1px dashed #e6e8ee; }
        .list li:last-child { border-bottom:0; }
        .instructions { white-space:pre-line; background:var(--soft); border:1px solid var(--border); border-radius:8px; padding:12px; }
        .facts { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; margin-top:6px; }
        .fact { border:1px solid var(--border); border-radius:10px; padding:12px; text-align:center; background:#fff; }
        .fact .value { font-size:16pt; font-weight:800; }
        .fact .unit { font-size:10pt; color:var(--muted); margin-left:4px; }
        .fact .label { margin-top:2px; font-size:10.5pt; color:var(--muted); }
        .note { font-size:10pt; color:var(--muted); margin-top:6px; }
        .page-break { page-break-before: always; }
        @media print { .no-print { display:none !important; } }
    </style>
</head>
<body>
<div class="wrap">
    <section class="header">
        <h1 th:text="${recipe.title}">Recipe Title</h1>

        <div class="meta">
            <div th:if="${recipe.sourceType == null
                        or #strings.equalsIgnoreCase(recipe.sourceType.toString(), 'USER')}">
                <strong>Author:</strong>
                <span th:text="${
                    (author != null and (!#strings.isEmpty(author.firstName()) or !#strings.isEmpty(author.lastName())))
                      ? #strings.trim( (author.firstName() ?: '') + ' ' + (author.lastName() ?: '') )
                      : (author != null ? author.email() : 'Unknown')
                }">author@email.com</span>
            </div>

            <div th:if="${recipe.sourceType != null
                        and #strings.equalsIgnoreCase(recipe.sourceType.toString(), 'AI')}">
                <strong>Source:</strong> <span>AI-generated</span>
            </div>

            <div><strong>Difficulty:</strong> <span th:text="${#strings.toLowerCase(recipe.difficulty)}">easy</span></div>
            <div><strong>Prep Time:</strong> <span th:text="${recipe.preparationTimeMinutes + ' min'}">30 min</span></div>

            <div th:if="${recipe != null and recipe.servings != null}">
                <strong>Servings:</strong>
                <span th:text="${recipe.servings.stripTrailingZeros().toPlainString()}">2</span>
            </div>
        </div>

        <div class="badges">
            <span class="badge" th:each="cat : ${recipe.mealCategories}" th:text="${cat.name}">Category</span>
        </div>
    </section>

    <section class="hero" th:if="${recipe.image != null}">
        <img th:src="${recipe.image.imageUrl}" alt="Recipe image" />
    </section>

    <section class="grid">
        <div>
            <div class="card">
                <h2>Ingredients</h2>
                <ul class="list ingredients">
                    <li th:each="ri : ${recipe.ingredients}"
                        th:with="amt=${ri.amount != null ? ri.amount.stripTrailingZeros().toPlainString() : ''},
                                 unitText=${ri.unit != null ? ri.unit.displayName : ''}"
                        th:text="${(amt != '' ? amt + ' ' : '')
                                   + (unitText != '' ? unitText + ' ' : '')
                                   + ri.ingredient.name}">
                        200 g example ingredient
                    </li>
                </ul>
                <p class="note" th:if="${#lists.isEmpty(recipe.ingredients)}">No ingredients listed.</p>
            </div>

            <div class="card">
                <h2>Instructions</h2>
                <div class="instructions" th:text="${recipe.instructions}">Instructions go here.</div>
            </div>
        </div>

        <aside>
            <div class="card">
                <h2>Nutrition Facts</h2>
                <p class="subtle">Calculated from ingredient amounts
                    <span th:if="${recipe != null and recipe.servings != null}">
                        • Servings: <strong th:text="${recipe.servings}"></strong>
                    </span>
                </p>
                <div class="facts">
                    <div class="fact">
                        <div class="value">
                            <span th:text="${recipe.kcalPerServ ?: '—'}">—</span>
                            <span class="unit" th:if="${recipe.kcalPerServ != null}">kcal</span>
                        </div>
                        <div class="label">Energy</div>
                    </div>
                    <div class="fact">
                        <div class="value">
                            <span th:text="${recipe.proteinPerServ ?: '—'}">—</span>
                            <span class="unit" th:if="${recipe.proteinPerServ != null}">g</span>
                        </div>
                        <div class="label">Protein</div>
                    </div>
                    <div class="fact">
                        <div class="value">
                            <span th:text="${recipe.carbsPerServ ?: '—'}">—</span>
                            <span class="unit" th:if="${recipe.carbsPerServ != null}">g</span>
                        </div>
                        <div class="label">Carbs</div>
                    </div>
                    <div class="fact">
                        <div class="value">
                            <span th:text="${recipe.fatPerServ ?: '—'}">—</span>
                            <span class="unit" th:if="${recipe.fatPerServ != null}">g</span>
                        </div>
                        <div class="label">Fat</div>
                    </div>
                </div>
            </div>

            <div class="card" th:if="${!#lists.isEmpty(recipe.mealCategories)}">
                <h3>Categories</h3>
                <div class="badges">
                    <span class="badge" th:each="cat : ${recipe.mealCategories}" th:text="${cat.name}">Category</span>
                </div>
            </div>
        </aside>
    </section>
</div>
</body>
</html>
